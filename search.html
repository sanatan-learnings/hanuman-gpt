---
layout: default
title: "Search Verses"
description: "Search through all Hanuman Chalisa verses by keyword, phrase, or meaning"
---
{% assign t_en = site.data.translations.en %}
{% assign t_hi = site.data.translations.hi %}

<div class="search-container">
    <div class="search-header">
        <h1>üîç <span data-lang="en">{{ t_en.search.title }}</span><span data-lang="hi">{{ t_hi.search.title }}</span></h1>
        <p><span data-lang="en">{{ t_en.search.subtitle }}</span><span data-lang="hi">{{ t_hi.search.subtitle }}</span></p>
    </div>

    <div class="search-box">
        <input
            type="text"
            id="searchInput"
            placeholder=""
            data-placeholder-en="{{ t_en.search.placeholder }}"
            data-placeholder-hi="{{ t_hi.search.placeholder }}"
            autocomplete="off"
        >
        <button id="clearSearch" style="display: none;">‚úï <span data-lang="en">{{ t_en.search.clear }}</span><span data-lang="hi">{{ t_hi.search.clear }}</span></button>
    </div>

    <div class="search-filters">
        <label><input type="checkbox" id="searchDevanagari" checked> <span data-lang="en">{{ t_en.search.filter_devanagari }}</span><span data-lang="hi">{{ t_hi.search.filter_devanagari }}</span></label>
        <label><input type="checkbox" id="searchTransliteration" checked> <span data-lang="en">{{ t_en.search.filter_transliteration }}</span><span data-lang="hi">{{ t_hi.search.filter_transliteration }}</span></label>
        <label><input type="checkbox" id="searchTranslation" checked> <span data-lang="en">{{ t_en.search.filter_translation }}</span><span data-lang="hi">{{ t_hi.search.filter_translation }}</span></label>
        <label><input type="checkbox" id="searchMeanings" checked> <span data-lang="en">{{ t_en.search.filter_meanings }}</span><span data-lang="hi">{{ t_hi.search.filter_meanings }}</span></label>
    </div>

    <div id="searchStats" class="search-stats"></div>

    <div id="searchResults" class="search-results">
        <p class="search-prompt" data-prompt-en="{{ t_en.search.prompt }}" data-prompt-hi="{{ t_hi.search.prompt }}"><span data-lang="en">{{ t_en.search.prompt }}</span><span data-lang="hi">{{ t_hi.search.prompt }}</span></p>
    </div>
</div>

<style>
.search-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
}

.search-header {
    text-align: center;
    margin-bottom: 30px;
}

.search-header h1 {
    color: #ff6b35;
    margin-bottom: 10px;
}

.search-header p {
    color: #666;
    font-size: 1.1em;
}

.search-box {
    position: relative;
    margin: 30px 0;
}

#searchInput {
    width: 100%;
    padding: 15px 50px 15px 20px;
    font-size: 1.1em;
    border: 2px solid #ddd;
    border-radius: 10px;
    outline: none;
    transition: border-color 0.3s;
}

#searchInput:focus {
    border-color: #ff6b35;
}

#clearSearch {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: #ff6b35;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
}

#clearSearch:hover {
    background: #e55a2b;
}

.search-filters {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.search-filters label {
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
    user-select: none;
}

.search-stats {
    text-align: center;
    color: #666;
    margin-bottom: 20px;
    font-size: 0.95em;
}

.search-results {
    margin-top: 30px;
}

.search-prompt {
    text-align: center;
    color: #999;
    font-style: italic;
    padding: 40px 20px;
}

.no-results {
    text-align: center;
    color: #999;
    padding: 40px 20px;
}

.search-result-item {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    transition: box-shadow 0.3s, transform 0.2s;
}

.search-result-item:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

.result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
}

.result-title {
    font-size: 1.3em;
    color: #ff6b35;
    margin: 0;
}

.result-link {
    color: #ff6b35;
    text-decoration: none;
    font-size: 0.9em;
}

.result-link:hover {
    text-decoration: underline;
}

.result-content {
    margin-top: 10px;
}

.result-snippet {
    margin: 10px 0;
    line-height: 1.6;
}

.result-label {
    font-weight: bold;
    color: #666;
    font-size: 0.85em;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.result-text {
    color: #333;
    margin-top: 5px;
}

.highlight {
    background-color: #fff3cd;
    padding: 2px 4px;
    border-radius: 3px;
    font-weight: 500;
}

/* Mobile responsive */
@media (max-width: 768px) {
    .search-filters {
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }

    .result-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
}
</style>

<script>
let versesData = [];
let searchTimeout;

// Get current language (same as language.js)
function getCurrentLanguage() {
    const urlParams = new URLSearchParams(window.location.search);
    const urlLang = urlParams.get('lang');
    const storedLang = localStorage.getItem('preferredLanguage');
    return urlLang || storedLang || 'en';
}

// Load verses data
fetch('{{ "/data/search.json" | relative_url }}')
    .then(response => response.json())
    .then(data => {
        versesData = data;
        console.log(`Loaded ${versesData.length} verses for search`);
    })
    .catch(error => {
        console.error('Error loading search data:', error);
        document.getElementById('searchResults').innerHTML =
            '<p class="no-results">Error loading search data. Please refresh the page.</p>';
    });

// Search input handler
document.getElementById('searchInput').addEventListener('input', function(e) {
    const query = e.target.value.trim();
    const clearBtn = document.getElementById('clearSearch');

    clearBtn.style.display = query ? 'block' : 'none';

    // Debounce search
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => performSearch(query), 300);
});

// Clear button handler
document.getElementById('clearSearch').addEventListener('click', function() {
    const currentLang = getCurrentLanguage();
    const promptElement = document.querySelector('.search-prompt');
    const promptText = currentLang === 'hi' ?
        promptElement.getAttribute('data-prompt-hi') :
        promptElement.getAttribute('data-prompt-en');

    document.getElementById('searchInput').value = '';
    this.style.display = 'none';
    document.getElementById('searchResults').innerHTML =
        `<p class="search-prompt">${escapeHtml(promptText)}</p>`;
    document.getElementById('searchStats').innerHTML = '';
});

// Filter change handlers
['searchDevanagari', 'searchTransliteration', 'searchTranslation', 'searchMeanings'].forEach(id => {
    document.getElementById(id).addEventListener('change', function() {
        const query = document.getElementById('searchInput').value.trim();
        if (query) performSearch(query);
    });
});

function performSearch(query) {
    const resultsDiv = document.getElementById('searchResults');
    const statsDiv = document.getElementById('searchStats');
    const currentLang = getCurrentLanguage();

    if (!query) {
        const promptElement = document.querySelector('.search-prompt');
        const promptText = currentLang === 'hi' ?
            promptElement.getAttribute('data-prompt-hi') :
            promptElement.getAttribute('data-prompt-en');
        resultsDiv.innerHTML = `<p class="search-prompt">${escapeHtml(promptText)}</p>`;
        statsDiv.innerHTML = '';
        return;
    }

    const filters = {
        devanagari: document.getElementById('searchDevanagari').checked,
        transliteration: document.getElementById('searchTransliteration').checked,
        translation: document.getElementById('searchTranslation').checked,
        meanings: document.getElementById('searchMeanings').checked
    };

    const results = searchVerses(query, filters);
    displayResults(results, query);
}

function searchVerses(query, filters) {
    const searchTerm = query.toLowerCase();
    const currentLang = getCurrentLanguage();
    const results = [];

    versesData.forEach(verse => {
        const matches = [];

        const labelDevanagari = currentLang === 'hi' ? '‡§¶‡•á‡§µ‡§®‡§æ‡§ó‡§∞‡•Ä' : 'Devanagari';
        const labelTranslit = currentLang === 'hi' ? '‡§≤‡§ø‡§™‡•ç‡§Ø‡§Ç‡§§‡§∞‡§£' : 'Transliteration';
        const labelTranslation = currentLang === 'hi' ? '‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶' : 'Translation';
        const labelMeaning = currentLang === 'hi' ? '‡§Ö‡§∞‡•ç‡§•' : 'Meaning';
        const labelStory = currentLang === 'hi' ? '‡§ï‡§π‡§æ‡§®‡•Ä' : 'Story';
        const labelWordMeaning = currentLang === 'hi' ? '‡§∂‡§¨‡•ç‡§¶ ‡§Ö‡§∞‡•ç‡§•' : 'Word Meaning';

        if (filters.devanagari && verse.devanagari) {
            if (verse.devanagari.toLowerCase().includes(searchTerm)) {
                matches.push({ type: labelDevanagari, text: verse.devanagari });
            }
        }

        if (filters.transliteration && verse.transliteration) {
            if (verse.transliteration.toLowerCase().includes(searchTerm)) {
                matches.push({ type: labelTranslit, text: verse.transliteration });
            }
        }

        if (filters.translation) {
            const litTranslation = currentLang === 'hi' ? verse.literal_translation_hi : verse.literal_translation_en;
            const intMeaning = currentLang === 'hi' ? verse.interpretive_meaning_hi : verse.interpretive_meaning_en;
            const story = currentLang === 'hi' ? verse.story_hi : verse.story_en;

            if (litTranslation && litTranslation.toLowerCase().includes(searchTerm)) {
                matches.push({ type: labelTranslation, text: litTranslation });
            }
            if (intMeaning && intMeaning.toLowerCase().includes(searchTerm)) {
                matches.push({ type: labelMeaning, text: intMeaning });
            }
            if (story && story.toLowerCase().includes(searchTerm)) {
                matches.push({ type: labelStory, text: story });
            }
        }

        if (filters.meanings && verse.word_meanings) {
            verse.word_meanings.forEach(item => {
                // Handle both old string format and new object format
                const meaning = item.meaning?.en || item.meaning?.hi || item.meaning;
                const meaningText = `${item.word} (${item.roman}) - ${meaning}`;
                if (meaningText.toLowerCase().includes(searchTerm)) {
                    matches.push({ type: labelWordMeaning, text: meaningText });
                }
            });
        }

        if (matches.length > 0) {
            results.push({
                verse: verse,
                matches: matches
            });
        }
    });

    return results;
}

function displayResults(results, query) {
    const resultsDiv = document.getElementById('searchResults');
    const statsDiv = document.getElementById('searchStats');
    const currentLang = getCurrentLanguage();

    if (results.length === 0) {
        const noResultsMsg = currentLang === 'hi' ?
            `"<strong>${escapeHtml(query)}</strong>" ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§è‡§ï ‡§Ö‡§≤‡§ó ‡§ñ‡•ã‡§ú ‡§∂‡§¨‡•ç‡§¶ ‡§Ü‡§ú‡§º‡§Æ‡§æ‡§è‡§Ç‡•§` :
            `No results found for "<strong>${escapeHtml(query)}</strong>". Try a different search term.`;
        resultsDiv.innerHTML = `<p class="no-results">${noResultsMsg}</p>`;
        statsDiv.innerHTML = '';
        return;
    }

    const foundMsg = currentLang === 'hi' ?
        `"<strong>${escapeHtml(query)}</strong>" ‡§ï‡•á ‡§≤‡§ø‡§è ${results.length} ‡§∂‡•ç‡§≤‡•ã‡§ï ‡§Æ‡§ø‡§≤‡•á` :
        `Found ${results.length} verse${results.length === 1 ? '' : 's'} matching "<strong>${escapeHtml(query)}</strong>"`;
    statsDiv.innerHTML = foundMsg;

    const viewDetailsText = currentLang === 'hi' ? '‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç ‚Üí' : 'View Full Verse ‚Üí';

    let html = '';
    results.forEach(result => {
        const verse = result.verse;
        const title = currentLang === 'hi' ? verse.title_hi : verse.title_en;
        const verseUrl = verse.url + (verse.url.includes('?') ? '&' : '?') + 'lang=' + currentLang;

        html += `
            <div class="search-result-item">
                <div class="result-header">
                    <h3 class="result-title">${escapeHtml(title)}</h3>
                    <a href="${verseUrl}" class="result-link">${viewDetailsText}</a>
                </div>
                <div class="result-content">
        `;

        result.matches.forEach(match => {
            const highlightedText = highlightQuery(match.text, query);
            html += `
                <div class="result-snippet">
                    <div class="result-label">${match.type}</div>
                    <div class="result-text">${highlightedText}</div>
                </div>
            `;
        });

        html += `
                </div>
            </div>
        `;
    });

    resultsDiv.innerHTML = html;
}

function highlightQuery(text, query) {
    if (!text) return '';
    const escapedText = escapeHtml(text);
    const escapedQuery = escapeHtml(query);
    const regex = new RegExp(`(${escapedQuery})`, 'gi');
    return escapedText.replace(regex, '<span class="highlight">$1</span>');
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Update placeholder based on language
function updateSearchPlaceholder() {
    const currentLang = getCurrentLanguage();
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        const placeholderKey = currentLang === 'hi' ? 'data-placeholder-hi' : 'data-placeholder-en';
        const placeholder = searchInput.getAttribute(placeholderKey);
        if (placeholder) {
            searchInput.placeholder = placeholder;
        }
    }
}

// Initialize search page - run after language.js has initialized
function initSearchPage() {
    // Wait a bit for language.js to complete
    setTimeout(function() {
        updateSearchPlaceholder();
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.focus();
        }
    }, 50);
}

// Run on DOM ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSearchPage);
} else {
    initSearchPage();
}
</script>
